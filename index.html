<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Consolidado de Laboratorio</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración de color y fuente Inter -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#4C51BF', // Indigo oscuro (Profesional)
                        'secondary': '#E0E7FF', // Light Indigo (Fondo suave)
                        'accent': '#F6AD55', // Naranja (Énfasis)
                        'success': '#10B981', // Verde (Éxito)
                        'danger': '#EF4444', // Rojo (Problema)
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .step-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .step-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(76, 81, 191, 0.2);
        }
        .section-title {
            color: #4C51BF;
            border-bottom: 4px solid #E0E7FF;
        }
        /* Icono de Libro (Inline SVG) */
        .book-icon {
            width: 32px;
            height: 32px;
            color: #4C51BF;
            stroke-width: 2;
        }
        /* Estilos generales para las tablas de datos */
        .data-table th {
            @apply p-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-100;
        }
        .data-table td {
            @apply p-3 whitespace-nowrap text-sm text-gray-800;
        }
        .data-table tr:nth-child(even) {
            @apply bg-white;
        }
        .highlight-row {
            @apply bg-accent/20 font-bold text-gray-900;
        }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-5xl mx-auto bg-white shadow-2xl rounded-2xl overflow-hidden border border-gray-100">

        <!-- Encabezado Principal -->
        <header class="bg-primary p-10 text-white text-center rounded-t-2xl">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-1 tracking-wider">INFORME CONSOLIDADO DIGITAL</h1>
            <p class="text-secondary text-xl italic font-light">Optimización del Layout para Entrega Electrónica (PDF)</p>
        </header>

        <!-- Sección 1: Problema y Solución -->
        <section class="p-6 md:p-10">
            <h2 class="text-3xl font-bold section-title mb-8 pb-3">1. Situación Actual y Objetivo Principal</h2>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Problema -->
                <div class="bg-danger/5 p-6 rounded-xl border-l-4 border-danger shadow-md flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-danger mr-4 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"></path></svg>
                    <div>
                        <h3 class="font-bold text-2xl text-danger mb-2">PROBLEMA ACTUAL (Ineficiencia)</h3>
                        <p class="text-gray-700 leading-relaxed">Cada examen se procesa como un documento independiente. Esto resulta en **múltiples archivos PDF** o múltiples secciones desordenadas para un mismo encuentro.</p>
                    </div>
                </div>

                <!-- Solución -->
                <div class="bg-success/5 p-6 rounded-xl border-l-4 border-success shadow-md flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-success mr-4 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    <div>
                        <h3 class="font-bold text-2xl text-success mb-2">OBJETIVO (Consolidación Digital)</h3>
                        <p class="text-gray-700 leading-relaxed">Unificar todos los resultados de un mismo día en **UN SOLO DOCUMENTO PDF/Digital**, aplicando una lógica de paginación precisa para garantizar un formato limpio.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección 2: Detalle Técnico - Ejemplo Completo Avanzado -->
        <section class="p-6 md:p-10 bg-secondary/30">
            <h2 class="text-3xl font-bold section-title mb-10 pb-3">2. Lógica Avanzada de Paginación y Consolidación (Ejemplo Completo)</h2>

            <!-- Contenedor de Pasos -->
            <div class="space-y-10">

                <!-- GRUPO 1: CONFIGURACIÓN Y DATOS RAW -->
                <div class="step-card bg-white p-6 rounded-xl shadow-2xl border-2 border-primary/50 space-y-8">
                    <h3 class="text-2xl font-bold text-primary border-b pb-2 mb-4">A. Configuración de Datos Base (BD)</h3>

                    <!-- 1. TABLA MAESTRA DE EXÁMENES (CONFIGURACIÓN) -->
                    <div class="overflow-x-auto">
                        <h4 class="font-bold text-lg mb-2 text-gray-700">1. TABLA MAESTRA DE EXÁMENES (CONFIGURACIÓN)</h4>
                        <table class="data-table w-full border-collapse border border-gray-200 rounded-lg">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>NOMBRE_EXAMEN</th>
                                    <th>LINEAS_OCUPA</th>
                                    <th>CAMPOS_PACIENTE</th>
                                    <th>CAMPOS_REFERENCIA</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white">
                                    <td>1</td>
                                    <td>GLUCOSA</td>
                                    <td>4</td>
                                    <td>valor, unidad</td>
                                    <td>"70-110 mg/dL"</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>HEMOGRAMA</td>
                                    <td>8</td>
                                    <td>hematocrito, hemoglobina, leucocitos</td>
                                    <td>"Hto: 40-50%, Hb: 12-16 g/dL, Leuc: 4,000-11,000"</td>
                                </tr>
                                <tr class="bg-white">
                                    <td>3</td>
                                    <td>UROCULTIVO</td>
                                    <td>25</td>
                                    <td>leucocitos_campo, hematias_campo, bacterias, microorganismo</td>
                                    <td>"Leuc: 0-4/campo, Hemat: 0-3/campo"</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="mt-2 text-sm text-gray-600 italic">**Nota:** El campo <strong class="text-primary">LINEAS_OCUPA</strong> incluye el título del examen, las líneas base del resultado y las líneas para el(los) valor(es) de referencia DINÁMICOS.</p>
                    </div>

                    <!-- 2. TABLA DE PACIENTES & 3. TABLA DE ORDENES -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- 2. PACIENTES -->
                        <div class="overflow-x-auto">
                            <h4 class="font-bold text-lg mb-2 text-gray-700">2. TABLA DE PACIENTES</h4>
                            <table class="data-table w-full border-collapse border border-gray-200">
                                <thead>
                                    <tr><th>ID</th><th>DNI</th><th>NOMBRE</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>1</td><td>76543210</td><td>Ana García López</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- 3. ORDENES -->
                        <div class="overflow-x-auto">
                            <h4 class="font-bold text-lg mb-2 text-gray-700">3. TABLA DE ÓRDENES (POR FECHA)</h4>
                            <table class="data-table w-full border-collapse border border-gray-200">
                                <thead>
                                    <tr><th>ID</th><th>FECHA</th><th>EXÁMENES</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>1001</td><td>2024-11-15</td><td>Glucosa, Hemograma, Urocultivo</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 4. TABLA DE RESULTADOS (SOLO DATOS PACIENTE) -->
                    <div class="overflow-x-auto">
                        <h4 class="font-bold text-lg mb-2 text-gray-700">4. TABLA DE RESULTADOS (DATOS CRUDOS DEL PACIENTE)</h4>
                        <table class="data-table w-full border-collapse border border-gray-200">
                            <thead>
                                <tr><th>ID_RES</th><th>ID_ORDEN</th><th>ID_EXAMEN</th><th>VALOR_1</th><th>VALOR_2</th><th>VALOR_3</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>5001</td><td>1001</td><td>1</td><td>"95"</td><td>"mg/dL"</td><td>NULL</td></tr>
                                <tr><td>5002</td><td>1001</td><td>2</td><td>"42%"</td><td>"14 g/dL"</td><td>"6,500"</td></tr>
                                <tr><td>5003</td><td>1001</td><td>3</td><td>"5-8/Campo"</td><td>"0-1/Campo"</td><td>"ESCASOS"</td></tr>
                            </tbody>
                        </table>
                        <p class="mt-2 text-sm text-gray-600 italic">**CRÍTICO:** Los valores de referencia NO están aquí. Se añaden en el paso de generación (runtime) consultando la Tabla Maestra (1).</p>
                    </div>
                </div>


                <!-- GRUPO 2: LÓGICA DE PAGINACIÓN Y RESULTADO -->
                <div class="step-card bg-accent/10 p-6 rounded-xl shadow-2xl border-2 border-accent space-y-8">
                    <h3 class="text-2xl font-bold text-accent border-b pb-2 mb-4">B. Cálculo de Paginación y Output Final (Máx. 22 líneas por hoja digital)</h3>

                    <!-- 5. CÁLCULO DE LÍNEAS Y HOJAS -->
                    <div class="overflow-x-auto">
                        <h4 class="font-bold text-lg mb-2 text-gray-700">5. CÁLCULO DE LÍNEAS Y HOJAS</h4>
                        <table class="data-table w-full border-collapse border border-gray-200">
                            <thead>
                                <tr><th>ID_ORDEN</th><th>EXAMEN</th><th>LINEAS_EXAMEN</th><th>LINEAS_SEPARADOR</th><th>LINEAS_ACUMULADAS</th><th>HOJA_ASIGNADA</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1001</td><td>Glucosa</td><td>4</td><td>1</td><td>5</td><td>1</td></tr>
                                <tr><td>1001</td><td>Hemograma</td><td>8</td><td>1</td><td>14</td><td>1</td></tr>
                                <tr class="highlight-row">
                                    <td>1001</td>
                                    <td>Urocultivo</td>
                                    <td>25</td>
                                    <td>1</td>
                                    <td>37</td>
                                    <td>2 (¡Salto!)</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="mt-4 p-4 bg-white rounded-lg border-l-4 border-success">
                            <p class="font-bold text-lg text-success">TOTAL LÍNEAS REQUERIDAS: 37</p>
                            <p class="font-bold text-lg text-success">TOTAL HOJAS GENERADAS: 2 <span class="text-sm text-gray-600 italic">(37 líneas ÷ 22 líneas máx. por hoja = 1.68 → Se necesitan 2 hojas)</span></p>
                        </div>
                    </div>

                    <!-- 6. INFORME GENERADO - HOJA 1 (Extracto) -->
                    <div class="overflow-x-auto">
                        <h4 class="font-bold text-lg mb-2 text-gray-700">6. INFORME GENERADO - HOJA 1 (Extracto del PDF)</h4>
                        <pre class="bg-gray-800 text-secondary p-4 rounded-lg text-sm whitespace-pre-wrap">
<span class="text-accent/80">LABORATORIO CLÍNICO CENTRAL (Título)</span>
<span class="text-secondary">INFORME DE RESULTADOS (Subtítulo)</span>
-----------------------------------
Paciente: Ana García López (Dato paciente)
DNI: 76543210 - Edad: 35 años (Dato paciente)
Fecha: 15/11/2024 (Dato paciente)
(Líneas de cabecera y datos de paciente consumen ~8 líneas)

<span class="text-accent">--- GLUCOSA ---</span> (4 líneas)
  Resultado: 95 mg/dL (Valor paciente)
  Valor referencia: 70-110 mg/dL (Valor referencia)
(Consumo acumulado: ~12 líneas)

<span class="text-accent">--- HEMOGRAMA ---</span> (8 líneas)
  Hematocrito: 42% (Valor paciente)
  Referencia: 40-50% (Valor referencia)
  Hemoglobina: 14 g/dL (Valor paciente)
  Referencia: 12-16 g/dL (Valor referencia)
  Leucocitos: 6,500 (Valor paciente)
  Referencia: 4,000-11,000 (Valor referencia)
(Consumo acumulado: ~21 líneas. El siguiente examen fuerza salto de página.)

<span class="text-danger">*** FIN DE HOJA 1 (Línea 22) ***</span>
</pre>
                    </div>

                    <!-- 7. INFORME GENERADO - HOJA 2 (Extracto) -->
                    <div class="overflow-x-auto">
                        <h4 class="font-bold text-lg mb-2 text-gray-700">7. INFORME GENERADO - HOJA 2 (Extracto del PDF)</h4>
                        <pre class="bg-gray-800 text-secondary p-4 rounded-lg text-sm whitespace-pre-wrap">
<span class="text-accent/80">LABORATORIO CLÍNICO CENTRAL (Título, repite header)</span>
<span class="text-secondary">Paciente: Ana García López (continuación) (Dato paciente)</span>
-----------------------------------
(Líneas de cabecera de la nueva página consumen ~3 líneas)

<span class="text-accent">--- UROCULTIVO ---</span> (25 líneas, empieza aquí)
  Leucocitos: 5-8/Campo (Valor paciente)
  Referencia: 0-4/Campo (Valor referencia)
  Hematías: 0-1/Campo (Valor paciente)
  Referencia: 0-3/Campo (Valor referencia)
  Bacterias: ESCASOS (Valor paciente)
  Recuento: >100 UFC/mL (Valor paciente)
  Microorganismo: Staphylococcus (Valor paciente)
  Resultado: POSITIVO (Valor paciente)
(El resto del examen UROCULTIVO y el footer de firma ocupan las líneas restantes de la Hoja 2)

FIRMA: ___________________ (Firma)
Dr. Carlos Rodríguez (Nombre médico)
CMP: 12345 (Colegiatura)
</pre>
                    </div>

                    <!-- 8. RESUMEN EJECUTIVO -->
                    <div class="overflow-x-auto">
                        <h4 class="font-bold text-lg mb-2 text-gray-700">8. RESUMEN EJECUTIVO (Eficacia de Consolidación)</h4>
                        <table class="data-table w-full border-collapse border border-gray-200">
                            <thead>
                                <tr><th>CONCEPTO</th><th>VALOR</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Paciente</td><td>Ana García López</td></tr>
                                <tr><td>Fecha</td><td>15/11/2024</td></tr>
                                <tr class="bg-primary/10 font-semibold text-primary"><td>Total exámenes</td><td>3</td></tr>
                                <tr class="bg-primary/10 font-semibold text-primary"><td>Total líneas ocupadas</td><td>37</td></tr>
                                <tr class="bg-primary/10 font-semibold text-primary"><td>Total hojas generadas</td><td>2</td></tr>
                                <tr><td>Espacio total disponible (2 hojas * 22 líneas)</td><td>44 líneas</td></tr>
                                <tr><td>Espacio utilizado</td><td>84% (37/44 líneas)</td></tr>
                                <tr><td>Espacio sobrante</td><td>7 líneas</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </section>

        <!-- Sección 3: Resumen y Ventajas -->
        <section class="p-6 md:p-10">
            <h2 class="text-3xl font-bold section-title mb-8 pb-3">3. Beneficios de la Consolidación Digital</h2>

            <div class="md:flex justify-around items-center mb-10 p-6 bg-primary/10 rounded-xl border border-primary/30">
                <div class="text-center">
                    <p class="text-lg font-bold text-gray-800">ANTES:</p>
                    <p class="text-2xl text-danger font-extrabold">3 Documentos Separados</p>
                </div>
                <div class="hidden md:block text-5xl text-primary font-light">→</div>
                <div class="text-center mt-4 md:mt-0">
                    <p class="text-lg font-bold text-gray-800">AHORA:</p>
                    <p class="text-3xl text-success font-extrabold">1 Documento PDF Unificado</p>
                </div>
            </div>

            <h3 class="text-2xl font-semibold text-primary mb-4">VENTAJAS CLAVE:</h3>
            <ul class="list-none space-y-3 text-gray-700">
                <li class="flex items-start">
                    <svg class="w-6 h-6 mr-3 text-success flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    <div>
                        <strong class="text-lg">Eficiencia de Archivo Digital:</strong> El paciente recibe un único PDF, simplificando el almacenamiento electrónico.
                    </div>
                </li>
                <li class="flex items-start">
                    <svg class="w-6 h-6 mr-3 text-success flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    <div>
                        <strong class="text-lg">Mejora de UX (User Experience):</strong> La lectura secuencial del informe es más profesional y clara, sin saltos de papel innecesarios.
                    </div>
                </li>
                <li class="flex items-start">
                    <svg class="w-6 h-6 mr-3 text-success flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    <div>
                        <strong class="text-lg">Control de Paginación:</strong> La lógica de conteo de renglones asegura que el layout de los exámenes (incluyendo las referencias variables) se adapte correctamente al tamaño de la página PDF.
                    </div>
                </li>
            </ul>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-100 p-4 text-center text-sm text-gray-600 rounded-b-2xl">
            Desarrollo de Sistemas de Laboratorio &copy; 2025 - Documentación de Lógica de Negocio
        </footer>

    </div>
</body>
</html>
